定时器中断处理流程:


(1)中断触发阶段

1.硬件中断：RISC-V定时器产生中断信号

2.异常处理：CPU跳转到stvec寄存器指定的异常向量地址

3.上下文保存：自动保存寄存器状态到陷阱帧

(2)中断分发阶段

1.陷阱分发：trap()函数调用trap_dispatch()

2.类型判断：根据tf->cause判断中断类型

3.路由处理：将定时器中断路由到interrupt_handler()

(3)定时器处理阶段

1.设置下次中断：调用clock_set_next_event()重置定时器

2.计数器更新：全局ticks变量自动递增

3.条件检查：检查ticks是否为100的倍数

4.打印处理：满足条件时调用print_ticks()输出信息

5.关机判断：打印10次后调用sbi_shutdown()关机

(4)中断返回阶段

1.上下文恢复：从陷阱帧恢复寄存器状态

2.特权级返回：使用sret指令返回到中断前状态

3.程序继续：恢复正常程序执行


练习一实现过程即为按照上述内容补全中断处理流程中对定时器处理的相关代码，主要体现在trap.c文件的interrupt_handler函数中，需要注意在clock.h中定义的ticks作为全局变量的使用。